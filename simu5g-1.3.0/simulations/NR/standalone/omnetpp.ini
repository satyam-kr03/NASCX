[General]
# If you want to run this scenario, make sure abstract is false (set true only for templates)
abstract = false
sim-time-limit = 20s
**.routingRecorder.enabled = false
*.configurator.addDefaultRoutes = false
*.configurator.typename = ""

# 1. SERVER CONFIGURATION
*.server.ipv4.interfaceTable.interface[0].address = "10.0.1.1"
*.server.ipv4.interfaceTable.interface[0].netmask = "255.255.255.0"
*.server.ipv4.routingTable.route[0].destination = "0.0.0.0"
*.server.ipv4.routingTable.route[0].netmask = "0.0.0.0"
*.server.ipv4.routingTable.route[0].gateway = "10.0.1.2"
*.server.ipv4.routingTable.route[0].interface = "ppp0"

# 2. ROUTER CONFIGURATION
*.router.ipv4.interfaceTable.interface[0].address = "10.0.1.2" # To server
*.router.ipv4.interfaceTable.interface[0].netmask = "255.255.255.0"
*.router.ipv4.interfaceTable.interface[1].address = "10.0.2.1" # To UPF
*.router.ipv4.interfaceTable.interface[1].netmask = "255.255.255.0"
*.router.ipv4.routingTable.route[0].destination = "0.0.0.0"
*.router.ipv4.routingTable.route[0].netmask = "0.0.0.0"
*.router.ipv4.routingTable.route[0].gateway = "10.0.2.2"
*.router.ipv4.routingTable.route[0].interface = "ppp1"

# 3. UPF CONFIGURATION
*.upf.ipv4.interfaceTable.interface[0].address = "10.0.2.2" # To router
*.upf.ipv4.interfaceTable.interface[0].netmask = "255.255.255.0"
*.upf.ipv4.interfaceTable.interface[1].address = "10.0.3.1" # To iUpf
*.upf.ipv4.interfaceTable.interface[1].netmask = "255.255.255.0"
*.upf.ipv4.routingTable.route[0].destination = "0.0.0.0"
*.upf.ipv4.routingTable.route[0].netmask = "0.0.0.0"
*.upf.ipv4.routingTable.route[0].gateway = "10.0.3.2"
*.upf.ipv4.routingTable.route[0].interface = "ppp0" # Assumes ppp0 connects to iUpf

# 4. iUPF CONFIGURATION
*.iUpf.ipv4.interfaceTable.interface[0].address = "10.0.3.2" # To UPF
*.iUpf.ipv4.interfaceTable.interface[0].netmask = "255.255.255.0"
*.iUpf.ipv4.interfaceTable.interface[1].address = "10.0.4.1" # To gNB
*.iUpf.ipv4.interfaceTable.interface[1].netmask = "255.255.255.0"
*.iUpf.ipv4.routingTable.route[0].destination = "0.0.0.0"
*.iUpf.ipv4.routingTable.route[0].netmask = "0.0.0.0"
*.iUpf.ipv4.routingTable.route[0].gateway = "10.0.4.2"
*.iUpf.ipv4.routingTable.route[0].interface = "ppp1"

# 5. GNB CONFIGURATION
*.gnb.ipv4.interfaceTable.interface[0].address = "10.0.0.1" # To UEs
*.gnb.ipv4.interfaceTable.interface[0].netmask = "255.255.255.0"
*.gnb.ipv4.interfaceTable.interface[1].address = "10.0.4.2" # To iUpf
*.gnb.ipv4.interfaceTable.interface[1].netmask = "255.255.255.0"
*.gnb.ipv4.routingTable.route[0].destination = "0.0.0.0"
*.gnb.ipv4.routingTable.route[0].netmask = "0.0.0.0"
*.gnb.ipv4.routingTable.route[0].gateway = "10.0.4.1"
*.gnb.ipv4.routingTable.route[0].interface = "ppp"

# 6. UE CONFIGURATION
.ue[].ipv4.interfaceTable.interface[0].address = "10.0.0." + string(parent.index+2)
.ue[].ipv4.interfaceTable.interface[0].netmask = "255.255.255.0"
.ue[].ipv4.routingTable.route[0].destination = "0.0.0.0"
.ue[].ipv4.routingTable.route[0].netmask = "0.0.0.0"
.ue[].ipv4.routingTable.route[0].gateway = "10.0.0.1"
.ue[].ipv4.routingTable.route[0].interface = "cellular"

############### Statistics ##################
output-scalar-file = ${resultdir}/${configname}/${repetition}.sca
output-vector-file = ${resultdir}/${configname}/${repetition}.vec
seed-set = ${repetition}
**.vector-recording = true
# ensure scalar recording isn't disabled elsewhere

################ Mobility parameters ####################
**.mobility.constraintAreaMaxX = 1000m
**.mobility.constraintAreaMaxY = 1000m
**.mobility.constraintAreaMinX = 0m
**.mobility.constraintAreaMinY = 0m
**.mobility.constraintAreaMinZ = 0m
**.mobility.constraintAreaMaxZ = 0m
**.mobility.initFromDisplayString = false

############### Number of Resource Blocks ###############
# TODO: verify correct parameter name in Simu5G (numPRB / numResourceBlocks / numBands)
**.numPRB = 273     # 273 PRBs ~= 100 MHz @ 30 kHz SCS (confirm exact name)

############### Transmission Power ##################
**.ueTxPower = 26dBm
**.eNodeBTxPower = 40dBm
**.targetBler = 0.01
**.blerShift = 5

############### Channel Model ##################
# TODO: confirm exact model class & parameter names in Simu5G
# Example: enable a Rayleigh / flat fading channel if supported by your channelModel
**.channelModel.type = "Rayleigh"        # verify parameter name
**.channelModel.fading = "fast"          # verify parameter name / enum

############### IPv4 configurator config #################
#*.configurator.config = xmldoc("./demo.xml")

#------------------------------------#
# Config Standalone
[Config Standalone]
network = simu5g.simulations.NR.networks.SingleCell_Standalone
sim-time-limit = 20s

############### gNodeB configuration #################
*.gnb.mobility.initialX = 450m
*.gnb.mobility.initialY = 300m

############## UE configuration ##################
*.numUe = 5

# --- Loop to auto-configure multiple UEs ---
.ue[].macCellId = 0
.ue[].masterId = 0
.ue[].nrMacCellId = 1
.ue[].nrMasterId = 1

# UE initial positions
*.ue[0].mobility.initialX = 450m
*.ue[0].mobility.initialY = 350m
*.ue[1].mobility.initialX = 400m
*.ue[1].mobility.initialY = 350m
*.ue[2].mobility.initialX = 500m
*.ue[2].mobility.initialY = 350m
*.ue[3].mobility.initialX = 450m
*.ue[3].mobility.initialY = 400m
*.ue[4].mobility.initialX = 450m
*.ue[4].mobility.initialY = 250m

#------------------------------------#
#------------------------------------#
# Config XRTraffic-DL (Corrected)
[Config XRTraffic-DL]
extends = Standalone

# Applications
# --- REVERSED LOGIC ---
.ue[].numApps = 1        # Each UE now has one sink app
*.server.numApps = 5       # The server now has one source app per UE

#============= Application Setup =============
# Server sends traffic (TrafficSource)
.server.app[].typename = "simu5g.apps.XRTraffic.TrafficSource"
.server.app[].fps = 60
# --- CORRECTED SYNTAX (using string concatenation) ---
.server.app[].destAddress = "ue[" + string(index) + "]"
.server.app[].destPort = 3000
.server.app[].localPort = 3088 + index

# UEs receive traffic (XRTrafficSink)
.ue[].app[0].typename = "simu5g.apps.XRTraffic.XRTrafficSink"
.ue[].app[0].localPort = 3000
.ue[].app[0].deadline = 10ms
.ue[].app[0].rmsePerFrame = 0.05